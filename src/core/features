üêç src/core/features.py

```python
import numpy as np
import cv2
from ..utils.memory import SmartCache

class ImageFeatureExtractor:
    """Robust feature extractor with caching."""
    
    def __init__(self, config):
        self.config = config
        self.cache = SmartCache(max_size=5)
    
    def extract_all(self, image):
        """Extract all features with caching support."""
        cache_key = self.cache.generate_key(image)
        cached = self.cache.get(cache_key)
        if cached is not None:
            return cached
            
        img_f = image.astype(np.float32) / 255.0 if image.dtype == np.uint8 else image.copy()
        
        features = {}
        # 1. Local Statistics
        features.update(self._extract_stats(img_f))
        # 2. Edges & Gradients
        features.update(self._extract_edges(img_f))
        
        self.cache.put(cache_key, features)
        return features

    def _extract_stats(self, img):
        kernel = np.ones((3,3), np.float32)/9.0
        mean = cv2.filter2D(img, -1, kernel)
        sq_mean = cv2.filter2D(img**2, -1, kernel)
        var = np.maximum(sq_mean - mean**2, 0)
        return {'local_mean': mean, 'local_var': var}

    def _extract_edges(self, img):
        gx = cv2.Scharr(img, cv2.CV_32F, 1, 0)
        gy = cv2.Scharr(img, cv2.CV_32F, 0, 1)
        mag = np.sqrt(gx**2 + gy**2)
        return {'gradient_magnitude': mag}
